# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

## Решение

Выберу **Gitlab**, хотя можно было бы выбрать еще **Team City**.
**Обоснование:**
- **Облачная система**: GitLab предлагает облачное решение через GitLab.com, а также возможность развертывания на собственных серверах (self-hosted).
- **Система контроля версий Git**: GitLab основан на Git и предоставляет все функции, связанные с системой контроля версий.
- **Репозиторий на каждый сервис**: В GitLab можно создавать отдельные репозитории для каждого проекта или сервиса.
- **Запуск сборки по событию из системы контроля версий**: GitLab CI/CD позволяет запускать сборки автоматически при определенных событиях, таких как коммиты или создание запросов на слияние.
- **Запуск сборки по кнопке с указанием параметров**: В GitLab можно вручную запускать сборки и передавать параметры через интерфейс.
- **Возможность привязать настройки к каждой сборке**: GitLab CI/CD позволяет настраивать пайплайны и конфигурации для каждой сборки.
- **Возможность создания шаблонов для различных конфигураций сборок**: GitLab поддерживает использование шаблонов для CI/CD, что позволяет создавать повторно используемые конфигурации.
- **Возможность безопасного хранения секретных данных (пароли, ключи доступа)**: GitLab предоставляет возможность хранить секреты и переменные окружения безопасно через интерфейс.
- **Несколько конфигураций для сборки из одного репозитория**: В GitLab можно настроить несколько пайплайнов и конфигураций для одного репозитория.
- **Кастомные шаги при сборке**: GitLab CI/CD позволяет добавлять кастомные шаги и скрипты в пайплайны.
- **Собственные докер-образы для сборки проектов**: GitLab поддерживает использование Docker и позволяет создавать и использовать собственные образы.
- **Возможность развернуть агентов сборки на собственных серверах**: GitLab Runner можно установить на собственных серверах для выполнения сборок.
- **Возможность параллельного запуска нескольких сборок**: GitLab CI/CD поддерживает параллельное выполнение сборок.
- **Возможность параллельного запуска тестов**: GitLab позволяет запускать тесты параллельно в рамках пайплайнов.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.


## Решение

Выберу **ELK**.

**Обоснование:**
- **Сбор логов в центральное хранилище со всех хостов, обслуживающих систему**: Logstash и Beats (например, Filebeat) могут собирать логи с различных хостов и отправлять их в Elasticsearch для хранения и анализа.
- **Минимальные требования к приложениям, сбор логов из stdout**: ELK Stack поддерживает сбор логов из стандартного вывода (stdout) приложений, что делает его удобным для контейнеризованных приложений и микросервисов.
- **Гарантированная доставка логов до центрального хранилища**: Logstash и Beats могут быть настроены для обеспечения надежной доставки логов, включая механизмы повторной попытки и буферизации.
- **Обеспечение поиска и фильтрации по записям логов**: Elasticsearch предоставляет мощные возможности для поиска и фильтрации данных, что позволяет быстро находить нужные записи логов.
- **Обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов**: Kibana предоставляет удобный веб-интерфейс для визуализации и поиска по логам, а также возможность настройки прав доступа.
- **Возможность дать ссылку на сохранённый поиск по записям логов**: Kibana позволяет сохранять поисковые запросы и делиться ссылками на них, что упрощает совместную работу и анализ логов.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

## Решение
Выберу **Prometheus + Grafana**.

**Обоснование:**
- **Сбор метрик со всех хостов, обслуживающих систему**: Prometheus может собирать метрики с различных хостов с помощью экспортеров (например, Node Exporter для системных метрик).
- **Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network**: Node Exporter предоставляет метрики о состоянии ресурсов хостов, включая использование CPU, RAM, HDD и сетевых интерфейсов.
- **Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network**: С помощью специализированных экспортеров или интеграций (например, cAdvisor для контейнеров) можно собирать метрики о потреблении ресурсов для каждого сервиса.
- **Сбор метрик, специфичных для каждого сервиса**: Prometheus позволяет настраивать сбор метрик, специфичных для приложений, через клиентские библиотеки, которые можно интегрировать в код сервисов.
- **Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию**: Prometheus предоставляет веб-интерфейс для выполнения запросов и просмотра метрик, а также поддерживает язык запросов PromQL для агрегации данных.
- **Пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы**: Grafana позволяет создавать настраиваемые панели для визуализации метрик, собранных Prometheus, и предоставляет мощные инструменты для создания дашбордов.
