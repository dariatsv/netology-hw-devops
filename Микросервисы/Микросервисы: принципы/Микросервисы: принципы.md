# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

## Решение

API Gateway можно реализовать на базе таких решений:
* [Amazon API Gateway](https://docs.aws.amazon.com/apigateway/latest/developerguide/welcome.html)
* [Kong](https://konghq.com/products/api-gateway-platform)
* [Krakend](https://www.krakend.io/)
* [Tyk](https://tyk.io/)

| Критерий            | Amazon API Gateway                                                                                  | Kong                                                                                 | Krakend                                                                      | Tyk                                                                       |
|---------------------|-----------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|------------------------------------------------------------------------------|---------------------------------------------------------------------------|
| Цена                | Есть free tier с ограничением по количеству запросов.                                               | Есть Open Source и платный Enterprise                                                | Есть Community Edition и Enterprise Edition                                  | Есть Open Source и платные тарифы в облаке                                |
| Производительсность | Хвалится производительностью                                                                        | Хвалятся производительностью                                                         | Быстрый и нетребовательный                                                   | Хвалятся, что они производительнее Kong                                   |
| Размещение          | Облако                                                                                              | SaaS (Kong Konnect) и размещение на хосте, в том числе с использованием контейнеров. | Размещение на хосте, в том числе с использованием контейнеров, в облаке.     | Размещение на хосте, в том числе с использованием контейнеров. Есть SaaS. |
| Расширения          | Есть расширения                                                                                     | Kong Plugin Hub                                                                      | Можно создавать свои плагины                                                 | Можно создавать свои плагины, можно найти готовые на GitHub               |
| Управление трафиком | Timeout, Retry, Circuit Breaker, Rate Limit                                                         | Timeout, Retry, Circuit Breaker, Rate Limit                                          | Rate Limit, Circuit Breaker, Timeout, Retry, Bot detector                    | Rate Limit, Circuit Breaker, Timeout, Retry                               |
| Аутентификация      | OAuth 2.0, Basic, JWT                                                                               | Basic, Key, OAuth 2.0, LDAP, OpenID Connect, HMAC, JWT                               | Basic, JWT, OAuth 2.0, mTLS, Google Cloud, NTLM                              | Basic, Bearer Token, OAuth 2.0, HMAC, JWT, OpenID Connect                 |
| Мониторинг          | Amazon CloudWatch Alarms, Amazon CloudWatch Logs, Amazon EventBridge, AWS CloudTrail Log Monitoring | Built-in, Prometheus, Datadog, StatsD                                                | OpenTelemetry, Prometheus, InfluxDB, Datadog, AWS X-Ray, Azure Monitor и др. | Built-in                                                                  |

По сравнительной таблице я бы выбрала бы **Kong**, как решение с огромным community и хорошей документацией. 

**Обоснование:**
1. **Гибкость и масштабируемость:** Kong является платформой с открытым исходным кодом, которая обладает гибкостью и расширяемостью для адаптации к различным требованиям. Он может легко масштабироваться для обработки высокой нагрузки, что является важным в случае микросервисной архитектуры, где количество сервисов может быть значительным.
2. **Обширные возможности:** Kong предлагает широкий набор функций API gateway, включая маршрутизацию запросов, проверку аутентификации и терминацию HTTPS. Он также обеспечивает управление трафиком, мониторинг, логирование и другие возможности, которые могут быть важными для разработки и эксплуатации вашей системы.
3. **Сообщество и поддержка:** Kong имеет активное сообщество разработчиков и пользователей, что обеспечивает доступ к обширной документации, руководствам и форумам для получения поддержки и решения возникающих вопросов.
4. **Интеграция с экосистемой:** Kong интегрируется с другими инструментами и технологиями, которые часто используются в микросервисных архитектурах, такими как Service Discovery и Load Balancer. Это позволяет создать совместимую и эффективную инфраструктуру для разработки и эксплуатации микросервисов.
5. **Открытый исходный код:** Благодаря тому, что Kong является платформой с открытым исходным кодом, вы получаете преимущество свободы в использовании, адаптации и распространении решения. Вы можете активно вносить изменения и расширять функциональность в соответствии с вашими потребностями.

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

## Решение

| Брокер сообщений            | Хранение сообщений на диске | Поддержка кластеризации | Поддержка форматов сообщений | Разделение прав доступа | Высокая скорость работы | Простота эксплуатации |
|-----------------------------|-----------------------------|-------------------------|------------------------------|-------------------------|-------------------------|-----------------------|
| RabbitMQ                    | Да                          | Да                      | Да                           | Да                      | Да                      | Да                    |
| Apache Kafka                | Да                          | Да                      | Да                           | Да                      | Да                      | Да                    |
| NATS Streaming              | Да                          | Да                      | Да                           | Да                      | Да                      | Да                    |
| Amazon SQS                  | Да                          | Да                      | Да                           | Да                      | Да                      | Да                    |
| Apache ActiveMQ             | Да                          | Да                      | Да                           | Да                      | Да                      | Да                    |
| Microsoft Azure Service Bus | Да                          | Да                      | Да                           | Да                      | Да                      | Да                    |
| Google Cloud Pub/Sub        | Да                          | Да                      | Да                           | Да                      | Да                      | Да                    |

Относительно сравнительной таблице я выберу в **Apache Kafka**.

**Обоснование:**
1. **Поддержка кластеризации:** Apache Kafka обеспечивает высокую надежность и отказоустойчивость путем поддержки кластеризации. Это позволяет создать распределенный брокер сообщений с репликацией данных, что обеспечивает сохранность сообщений и возможность продолжения работы даже при отказе узлов.
2. **Высокая скорость работы:** Apache Kafka предлагает высокую пропускную способность и низкую задержку при передаче сообщений. Он способен обрабатывать миллионы сообщений в секунду, что является важным при работе с высоконагруженными системами.
3. **Поддержка различных форматов сообщений:** Apache Kafka поддерживает гибкий формат данных, что позволяет передавать сообщения в различных форматах, включая JSON, Avro и другие.
4. **Хранение сообщений на диске:** Apache Kafka хранит сообщения на диске в процессе доставки, что обеспечивает сохранность сообщений в случае временных сбоев и позволяет обрабатывать большие объемы данных.
5. **Разделение прав доступа:** Apache Kafka предоставляет механизм разделения прав доступа к различным потокам сообщений. Это позволяет управлять доступом и обеспечить безопасность передачи данных в системе.
6. **Простота эксплуатации:** Apache Kafka имеет развитое сообщество пользователей и обширную документацию, что облегчает его внедрение, настройку и поддержку. Он также интегрируется с различными инструментами и фреймворками, что упрощает его использование в разных сценариях.